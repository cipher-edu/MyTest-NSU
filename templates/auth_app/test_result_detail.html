{% extends 'auth_app/base.html' %}

{% block page_title %}Natija: {{ result.test.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto animate-fade-in">
    <div class="mb-6">
        <a href="{% url 'test-list' %}" class="inline-flex items-center text-sm font-medium text-slate-600 hover:text-primary-600 transition-colors">
            <ion-icon name="arrow-back-outline" class="mr-2"></ion-icon>
            Barcha testlarga qaytish
        </a>
    </div>

    <!-- Natija xulosasi kartochkasi -->
    <div class="bg-white rounded-2xl shadow-soft border border-slate-100 p-8 mb-8">
        <div class="text-center">
            <p class="text-sm font-medium text-primary-600">Sizning natijangiz</p>
            <h1 class="text-4xl font-bold font-serif text-slate-900 mt-1">{{ result.test.title }}</h1>
            <div class="my-6">
                <span class="text-6xl font-bold text-slate-800">{{ result.score|floatformat:1 }}</span>
                <span class="text-2xl text-slate-500">/ {{ result.test.max_score|floatformat:1 }} ball</span>
            </div>
            {% with percentage=result.score|div:result.test.max_score|mul:100 %}
            <div class="w-full bg-slate-200 rounded-full h-4">
                <div class="gpa-progress-bar h-4 rounded-full" style="width: {{ percentage|floatformat:2 }}%;"></div>
            </div>
            <p class="mt-2 text-sm text-slate-500">Umumiy ko'rsatkich: {{ percentage|floatformat:2 }}%</p>
            {% endwith %}
        </div>
    </div>

    <!-- Javoblar tahlili -->
    <div>
        <h2 class="text-2xl font-bold text-slate-800 mb-5">Javoblar tahlili</h2>
        <div class="space-y-4">
            {% for sa in result.student_answers.all %}
                <div class="bg-white rounded-xl border p-5
                    {% if sa.chosen_answer.is_correct %} border-green-200 {% else %} border-red-200 {% endif %}">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 mr-4">
                            {% if sa.chosen_answer.is_correct %}
                                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-green-100">
                                    <ion-icon name="checkmark-outline" class="text-xl text-green-600"></ion-icon>
                                </span>
                            {% else %}
                                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-red-100">
                                    <ion-icon name="close-outline" class="text-xl text-red-600"></ion-icon>
                                </span>
                            {% endif %}
                        </div>
                        <div class="flex-grow">
                            <p class="font-medium text-slate-800">{{ forloop.counter }}. {{ sa.question.text }}</p>
                            <div class="mt-3 text-sm">
                                <p><strong>Sizning javobingiz:</strong> 
                                    <span class="{% if not sa.chosen_answer.is_correct %}text-red-600 line-through{% else %}text-green-700{% endif %}">
                                        {{ sa.chosen_answer.text|default:"Javob berilmagan" }}
                                    </span>
                                </p>
                                {% if not sa.chosen_answer.is_correct %}
                                    {% for answer in sa.question.answers.all %}
                                        {% if answer.is_correct %}
                                            <p class="mt-1"><strong>To'g'ri javob:</strong> <span class="text-green-700">{{ answer.text }}</span></p>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}